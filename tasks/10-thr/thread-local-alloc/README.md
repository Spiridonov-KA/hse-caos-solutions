# Thread-local alloc

В этой задачке вы напишете thread-aware аллокатор. Как вы уже могли заметить,
синхронизация потоков несет в себе дополнительные накладные расходы, поэтому в аллокаторах,
чтобы избежать синхронизации, часто используют thread-local арены. В случае, если
в такой арене возможно выделить необходимый кусок памяти, потоку не нужно обращаться в
общую арену, синхронизируясь с другими потоками. Например, в
[реализации](https://elixir.bootlin.com/glibc/glibc-2.41.9000/source/malloc/malloc.c#L3127)
`malloc` в `glibc` используется
[tcache](https://sourceware.org/glibc/wiki/MallocInternals#Thread_Local_Cache_.28tcache.29)
-- отдельная арена для этих целей.

В этой задаче вы реализуете похожий механизм. В файле [storage.hpp](./storage.hpp) вы можете
найти функции, которые вам надо реализовать. `Alloc` должен уметь аллоцировать память без
синхронизации с другими потоками, а также записывать статистику о своем использовании.

`OnThreadStart`/`OnThreadStop` вызываются в начале/конце работы треда. В `OnThreadStart`
передается указатель на структуру `Stat`, в которую вам нужно записывать статистику
аллокаций.

Для простоты реализации, деаллоцировать возможно только всю аллоцированную потоком память
с помощью метода `Dealloc`. Этот же метод должен сбрасывать всю статистику аллокаций.

Гарантируется, что суммарный размер всех аллокаций в одном потоке между соседними вызовами
`Dealloc` не превосходит 1MB. Так же гарантируется, что `alignment` – степень двойки.

Не допускайте лишней коммуникации между потоками (в том числе неявной). Возможно, для
прохождения тестов вам понадобится прочитать их код ;)
