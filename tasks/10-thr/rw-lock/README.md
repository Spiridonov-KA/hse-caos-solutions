# RW-lock

Реализуйте RW-lock. Этот синхронизационный примитив должен удовлетворять следующим
свойствам:

- Блокировка может находится в *одном* из двух состояний: эксклюзивном и коллективном
- В коллективном состоянии блокировка пропускает неограниченное количество потоков-читателей
- В эксклюзивном состоянии блокировка пропускает 1 поток на запись и никого больше
- Блокировка не должна допускать `write starvation`. То есть, если есть поток, ожидающий
    захвата блокировки на запись, он не должен бесконечно голодать в пользу потоков,
    захватывающих блокировку на чтение.

Используйте `futex` для (долгого) ожидания

Эта задача разбита на 2 части:

1. Блокирующий rw-lock
1. Блокирующий rw-lock, не допускающий голодания потоков-писателей

## Советы по реализации

Рекомендуется решать задачу в следующем порядке:

1. Реализуйте сначала rw-spinlock, не поддерживающий блокировку потока с помощью
    futex, он должен проходить бОльшую часть тестов
1. Добавьте поддержку блокировки потока с помощью `futex`
1. Решите проблему write starvation

---

## Полезные материалы

- [`compare_exchange`](https://en.cppreference.com/w/cpp/atomic/atomic/compare_exchange.html)
- [std::shared_mutex](https://en.cppreference.com/w/cpp/thread/shared_mutex.html)
- [`futex` implementation in linux kernel](https://elixir.bootlin.com/linux/v6.17.9/source/kernel/futex/waitwake.c)
