# Execvpe

Вы уже успели познакомиться со всем многообразием библиотечных вызовов семейства
[`exec*`](https://www.man7.org/linux/man-pages/man3/exec.3.html), и, если вы пробовали
найти соответствующие им [системные вызовы](https://filippo.io/linux-syscall-table/), вы могли
заметить, что соответствует им единственный системный вызов
[`execve`](https://www.man7.org/linux/man-pages/man2/execve.2.html), который не выполняет
поиск по `PATH`. Это означает, что вся логика, касающаяся поиска исполняемого файла в `PATH`,
реализована исключительно в стандартной библиотеке. В этой задаче вам предстоит реализовать
эту логику самостоятельно.

Реализуйте функцию `ExecVPE` в файле [`execvpe.cpp`](./execvpe.cpp), которая повторяет поведение
библиотечной функции [`execvpe`](https://www.man7.org/linux/man-pages/man3/exec.3.html).
Если у запускаемого процесса нет переменной окружения `PATH`, используйте
`/usr/local/bin:/bin:/usr/bin`.

Гарантируется, что ни один из аргументов не является `nullptr`.

В этой задаче ваше решение будет собираться [без стандартной библиотеки](../../../docs/nostd.md).
Для выполнения системного вызова `execve` используйте функцию `ExecVE` из заголовочного файла
[`syscalls.hpp`](../../../common/syscalls/include/syscalls.hpp). Для доступа к переменным
окружения используйте глобальную переменную `Environ`, которая имеет такой же смысл, как и
[аналогичная переменная](https://www.man7.org/linux/man-pages/man7/environ.7.html) в стандартной библиотеке.

Если вы решали задачу `c-strings`, в этой задаче вам доступны ваши реализации функций
из файла `no-alloc.cpp`.

> [!note] Указание
>
> Реализуйте отдельно простую программу, которая вызывает библиотечную функцию
> `execlp` и запустите ее под [`strace`](https://www.man7.org/linux/man-pages/man1/strace.1.html):
>
> ```sh
> strace ./executable
> ```
>
> Посмотрите, в какую последовательность системных вызовов превращается один
> вызов `execlp`. Реализуйте аналогичную логику.

> [!warning]
>
> Обратите внимание на то, что тесты предполагают наличие стандартных утилит вроде
> `echo` по стандартным путям (`/usr/local/bin`, `/bin` или `/usr/bin`). Если эти
> утилиты у вас находятся по другим путям, локальные тесты корректного решения могут
> завершаться с ошибкой.


<details>
<summary>Гарантии, детали реализации и подсказки</summary>

Гарантируется, что в случае, если `file` не содержит в себе символов `/`,
сумма его длины и любой части `PATH` не превосходит
[`PATH_MAX`](https://askubuntu.com/questions/859945/what-is-the-maximum-length-of-a-file-path-in-ubuntu).

При итерации по компонентам `PATH`, игнорируйте ошибки `ENOENT`, `ENOTDIR` и `EACCES`. При завершении
`ExecVPE` с ошибкой, не требуется совпадение переменной `Errno` с библиотечной реализацией.
</details>
